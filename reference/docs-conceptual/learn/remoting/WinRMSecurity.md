---
ms.date: 06/05/2017
keywords: powershell,cmdlet
title: WinRMSecurity
ms.openlocfilehash: 59717e4806857e6760de523335bbee6028da8e84
ms.sourcegitcommit: 00ff76d7d9414fe585c04740b739b9cf14d711e1
ms.translationtype: MTE95
ms.contentlocale: de-DE
ms.lasthandoff: 12/14/2018
ms.locfileid: "53401418"
---
# <a name="powershell-remoting-security-considerations"></a><span data-ttu-id="92946-103">Sicherheitsaspekte von PowerShell-Remoting</span><span class="sxs-lookup"><span data-stu-id="92946-103">PowerShell Remoting Security Considerations</span></span>

<span data-ttu-id="92946-104">PowerShell-Remoting ist die empfohlene Methode zum Verwalten von Windows-Systemen.</span><span class="sxs-lookup"><span data-stu-id="92946-104">PowerShell Remoting is the recommended way to manage Windows systems.</span></span> <span data-ttu-id="92946-105">PowerShell-Remoting ist unter Windows Server 2012 R2 standardmäßig aktiviert.</span><span class="sxs-lookup"><span data-stu-id="92946-105">PowerShell Remoting is enabled by default in Windows Server 2012 R2.</span></span> <span data-ttu-id="92946-106">Dieses Dokument behandelt Sicherheitsaspekte, Empfehlungen und bewährte Methoden bei der Verwendung von PowerShell-Remoting.</span><span class="sxs-lookup"><span data-stu-id="92946-106">This document covers security concerns, recommendations, and best practices when using PowerShell Remoting.</span></span>

## <a name="what-is-powershell-remoting"></a><span data-ttu-id="92946-107">Was ist PowerShell-Remoting?</span><span class="sxs-lookup"><span data-stu-id="92946-107">What is PowerShell Remoting?</span></span>

<span data-ttu-id="92946-108">PowerShell-Remoting verwendet [Windows-Remoteverwaltung (WinRM)](https://msdn.microsoft.com/library/windows/desktop/aa384426.aspx), wobei es sich um die Microsoft-Implementierung des Protokolls von [Web Services for Management (WS-Management)](https://www.dmtf.org/sites/default/files/standards/documents/DSP0226_1.2.0.pdf) handelt, um Benutzern die Ausführung von PowerShell-Befehlen auf Remotecomputern zu ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="92946-108">PowerShell Remoting uses [Windows Remote Management (WinRM)](https://msdn.microsoft.com/library/windows/desktop/aa384426.aspx), which is the Microsoft implementation of the [Web Services for Management (WS-Management)](https://www.dmtf.org/sites/default/files/standards/documents/DSP0226_1.2.0.pdf) protocol, to allow users to run PowerShell commands on remote computers.</span></span> <span data-ttu-id="92946-109">Weitere Informationen zur Verwendung von PowerShell-Remoting finden Sie unter [Ausführen von Remotebefehlen](https://technet.microsoft.com/library/dd819505.aspx).</span><span class="sxs-lookup"><span data-stu-id="92946-109">You can find more information about using PowerShell Remoting at [Running Remote Commands](https://technet.microsoft.com/library/dd819505.aspx).</span></span>

<span data-ttu-id="92946-110">PowerShell-Remoting unterscheidet sich von Ausführung eines Cmdlets auf einem Remotecomputer unter Verwendung des Parameters **ComputerName**, wobei ein Remoteprozeduraufruf (RPC) als zugrunde liegendes Protokoll verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="92946-110">PowerShell Remoting is not the same as using the **ComputerName** parameter of a cmdlet to run it on a remote computer, which uses Remote Procedure Call (RPC) as its underlying protocol.</span></span>

## <a name="powershell-remoting-default-settings"></a><span data-ttu-id="92946-111">Standardeinstellungen für PowerShell-Remoting</span><span class="sxs-lookup"><span data-stu-id="92946-111">PowerShell Remoting default settings</span></span>

<span data-ttu-id="92946-112">PowerShell-Remoting (und WinRM) lauschen an folgenden Ports:</span><span class="sxs-lookup"><span data-stu-id="92946-112">PowerShell Remoting (and WinRM) listen on the following ports:</span></span>

- <span data-ttu-id="92946-113">HTTP: 5985</span><span class="sxs-lookup"><span data-stu-id="92946-113">HTTP: 5985</span></span>
- <span data-ttu-id="92946-114">HTTPS: 5986</span><span class="sxs-lookup"><span data-stu-id="92946-114">HTTPS: 5986</span></span>

<span data-ttu-id="92946-115">Standardmäßig gestattet PowerShell-Remoting nur Verbindungen von Mitgliedern der Gruppe „Administratoren“.</span><span class="sxs-lookup"><span data-stu-id="92946-115">By default, PowerShell Remoting only allows connections from members of the Administrators group.</span></span> <span data-ttu-id="92946-116">Sitzungen werden im Kontext des Benutzers gestartet, weshalb alle Betriebssystem-Zugriffssteuerungen, die auf einzelne Benutzer und Gruppen angewendet wurden, für diese weiterhin gelten, während die Verbindung über PowerShell-Remoting besteht.</span><span class="sxs-lookup"><span data-stu-id="92946-116">Sessions are launched under the user's context, so all operating system access controls applied to individual users and groups continue to apply to them while connected over PowerShell Remoting.</span></span>

<span data-ttu-id="92946-117">In privaten Netzwerken akzeptiert die Windows-Firewall-Standardregel für PowerShell-Remoting alle Verbindungen.</span><span class="sxs-lookup"><span data-stu-id="92946-117">On private networks, the default Windows Firewall rule for PowerShell Remoting accepts all connections.</span></span> <span data-ttu-id="92946-118">In öffentlichen Netzwerken lässt die Windows-Firewall-Standardregel Verbindungen mit PowerShell-Remoting nur aus demselben Subnetz heraus zu.</span><span class="sxs-lookup"><span data-stu-id="92946-118">On public networks, the default Windows Firewall rule allows PowerShell Remoting connections only from within the same subnet.</span></span> <span data-ttu-id="92946-119">Sie müssen diese Regel explizit ändern, um PowerShell-Remoting für alle Verbindungen in einem öffentlichen Netzwerk zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="92946-119">You have to explicitly change that rule to open PowerShell Remoting to all connections on a public network.</span></span>

><span data-ttu-id="92946-120">Warning Die Firewallregel für öffentliche Netzwerke soll den Computer vor potenziell schädlichen, externen Verbindungsversuchen schützen.</span><span class="sxs-lookup"><span data-stu-id="92946-120">**Warning:** The firewall rule for public networks is meant to protect the computer from potentially malicious external connection attempts.</span></span> <span data-ttu-id="92946-121">Seien Sie vorsichtig beim Entfernen dieser Regel.</span><span class="sxs-lookup"><span data-stu-id="92946-121">Use caution when removing this rule.</span></span>

## <a name="process-isolation"></a><span data-ttu-id="92946-122">Prozessisolation</span><span class="sxs-lookup"><span data-stu-id="92946-122">Process isolation</span></span>

<span data-ttu-id="92946-123">PowerShell-Remoting verwendet [Windows-Remoteverwaltung (WinRM)](https://msdn.microsoft.com/library/windows/desktop/aa384426) für die Kommunikation zwischen Computern.</span><span class="sxs-lookup"><span data-stu-id="92946-123">PowerShell Remoting uses [Windows Remote Management (WinRM)](https://msdn.microsoft.com/library/windows/desktop/aa384426) for communication between computers.</span></span>
<span data-ttu-id="92946-124">WinRM wird als Dienst unter dem „Netzwerkdienst“-Konto ausgeführt, und erstellt isolierte Prozesse, die als Benutzerkonten ausgeführt werden, um PowerShell-Instanzen zu hosten.</span><span class="sxs-lookup"><span data-stu-id="92946-124">WinRM runs as a service under the Network Service account, and spawns isolated processes running as user accounts to host PowerShell instances.</span></span> <span data-ttu-id="92946-125">Eine Instanz von PowerShell, die als ein Benutzer ausgeführt wird, hat keinen Zugriff auf einen Prozess, der eine Instanz von PowerShell als ein anderer Benutzer ausführt.</span><span class="sxs-lookup"><span data-stu-id="92946-125">An instance of PowerShell running as one user has no access to a process running an instance of PowerShell as another user.</span></span>

## <a name="event-logs-generated-by-powershell-remoting"></a><span data-ttu-id="92946-126">Von PowerShell-Remoting generierte Ereignisprotokolle</span><span class="sxs-lookup"><span data-stu-id="92946-126">Event logs generated by PowerShell Remoting</span></span>

<span data-ttu-id="92946-127">FireEye stellt eine gute Zusammenfassung der Ereignisprotokolle und andere Sicherheitsinformationen, die von PowerShell-Remotingsitzungen generiert werden, unter [Investigating PowerShell Attacks](https://www.fireeye.com/content/dam/fireeye-www/global/en/solutions/pdfs/wp-lazanciyan-investigating-powershell-attacks.pdf) (Untersuchen von PowerShell-Angriffen) bereit.</span><span class="sxs-lookup"><span data-stu-id="92946-127">FireEye has provided a good summary of the event logs and other security evidence generated by PowerShell Remoting sessions, available at [Investigating PowerShell Attacks](https://www.fireeye.com/content/dam/fireeye-www/global/en/solutions/pdfs/wp-lazanciyan-investigating-powershell-attacks.pdf).</span></span>

## <a name="encryption-and-transport-protocols"></a><span data-ttu-id="92946-128">Verschlüsselung und Transportprotokolle</span><span class="sxs-lookup"><span data-stu-id="92946-128">Encryption and transport protocols</span></span>

<span data-ttu-id="92946-129">Es ist hilfreich, die Sicherheit einer PowerShell-Remotingverbindung aus zwei Blickwinkeln zu betrachten: anfängliche Authentifizierung und laufende Kommunikation.</span><span class="sxs-lookup"><span data-stu-id="92946-129">It is helpful to consider the security of a PowerShell Remoting connection from two perspectives: initial authentication, and ongoing communication.</span></span>

<span data-ttu-id="92946-130">Unabhängig vom verwendeten Transportprotokoll (HTTP oder HTTPS) verschlüsselt PowerShell-Remoting immer die gesamte Kommunikation im Anschluss an die anfängliche Authentifizierung mit einem sitzungsbezogenen, symmetrischen AES-256-Schlüssel.</span><span class="sxs-lookup"><span data-stu-id="92946-130">Regardless of the transport protocol used (HTTP or HTTPS), PowerShell Remoting always encrypts all communication after initial authentication with a per-session AES-256 symmetric key.</span></span>

### <a name="initial-authentication"></a><span data-ttu-id="92946-131">Anfängliche Authentifizierung</span><span class="sxs-lookup"><span data-stu-id="92946-131">Initial authentication</span></span>

<span data-ttu-id="92946-132">Mit der Authentifizierung wird die Identität des Clients gegenüber dem Server bestätigt und idealerweise die des Servers gegenüber dem Client.</span><span class="sxs-lookup"><span data-stu-id="92946-132">Authentication confirms the identity of the client to the server - and ideally - the server to the client.</span></span>

<span data-ttu-id="92946-133">Wenn ein Client eine Verbindung mit einem Domänenserver mithilfe seines Computernamens herstellt (d. h.: „server01“ oder „server01.contoso.com“), ist das Standardprotokoll für die Authentifizierung [Kerberos](https://msdn.microsoft.com/library/windows/desktop/aa378747.aspx).</span><span class="sxs-lookup"><span data-stu-id="92946-133">When a client connects to a domain server using its computer name (i.e.: server01, or server01.contoso.com), the default authentication protocol is [Kerberos](https://msdn.microsoft.com/library/windows/desktop/aa378747.aspx).</span></span>
<span data-ttu-id="92946-134">Kerberos garantiert sowohl die Identität des Benutzers als auch die des Servers, ohne dabei jegliche Art von wiederverwendbaren Anmeldeinformationen zu senden.</span><span class="sxs-lookup"><span data-stu-id="92946-134">Kerberos guarantees both the user identity and server identity without sending any sort of reusable credential.</span></span>

<span data-ttu-id="92946-135">Wenn ein Client eine Verbindung mit einem Domänenserver mithilfe seiner IP-Adresse oder eine Verbindung mit einem Arbeitsgruppenserver herstellt, ist eine Authentifizierung mittels Kerberos nicht möglich.</span><span class="sxs-lookup"><span data-stu-id="92946-135">When a client connects to a domain server using its IP address, or connects to a workgroup server, Kerberos authentication is not possible.</span></span> <span data-ttu-id="92946-136">In diesem Fall verwendet PowerShell-Remoting dann das [NTLM-Authentifizierungsprotokoll](https://msdn.microsoft.com/library/windows/desktop/aa378749.aspx).</span><span class="sxs-lookup"><span data-stu-id="92946-136">In that case, PowerShell Remoting relies on the [NTLM authentication protocol](https://msdn.microsoft.com/library/windows/desktop/aa378749.aspx).</span></span> <span data-ttu-id="92946-137">Die NTLM-Authentifizierung garantiert die Identität des Benutzers, ohne dabei jegliche Art von delegierbaren Anmeldeinformationen zu senden.</span><span class="sxs-lookup"><span data-stu-id="92946-137">The NTLM authentication protocol guarantees the user identity without sending any sort of delegable credential.</span></span> <span data-ttu-id="92946-138">Um die Identität des Benutzers nachzuweisen, erfordert das NTLM-Protokoll, dass sowohl der Client als auch der Server einen Sitzungsschlüssel aus dem Kennwort des Benutzers berechnen, ohne dabei jemals das Kennwort selbst auszutauschen.</span><span class="sxs-lookup"><span data-stu-id="92946-138">To prove user identity, the NTLM protocol requires that both the client and server compute a session key from the user's password without ever exchanging the password itself.</span></span> <span data-ttu-id="92946-139">Der Server kennt in der Regel das Kennwort des Benutzers nicht, weshalb er mit dem Domänencontroller kommuniziert, der das Kennwort des Benutzers kennt und den Sitzungsschlüssel für den Server berechnet.</span><span class="sxs-lookup"><span data-stu-id="92946-139">The server typically does not know the user's password, so it communicates with the domain controller, which does know the user's password and calculates the session key for the server.</span></span>

<span data-ttu-id="92946-140">Das NTLM-Protokoll garantiert jedoch nicht die Identität des Servers.</span><span class="sxs-lookup"><span data-stu-id="92946-140">The NTLM protocol does not, however, guarantee server identity.</span></span> <span data-ttu-id="92946-141">Wie bei allen Protokollen, die NTLM für die Authentifizierung verwenden, könnte ein Angreifer, der Zugriff auf das Computerkonto eines der Domäne beigetretenen Computers hat, den Domänencontroller zur Berechnung eines NTLM-Sitzungsschlüssels aufrufen und auf diese Art die Identität des Servers annehmen.</span><span class="sxs-lookup"><span data-stu-id="92946-141">As with all protocols that use NTLM for authentication, an attacker with access to a domain-joined computer's machine account could invoke the domain controller to compute an NTLM session-key and thereby impersonate the server.</span></span>

<span data-ttu-id="92946-142">NTLM-basierte Authentifizierung ist standardmäßig deaktiviert, kann aber zugelassen werden, indem entweder SSL auf dem Zielserver oder die WinRM-Einstellung „TrustedHosts“ auf dem Client konfiguriert wird.</span><span class="sxs-lookup"><span data-stu-id="92946-142">NTLM-based authentication is disabled by default, but may be permitted by either configuring SSL on the target server, or by configuring the WinRM TrustedHosts setting on the client.</span></span>

#### <a name="using-ssl-certificates-to-validate-server-identity-during-ntlm-based-connections"></a><span data-ttu-id="92946-143">Verwenden von SSL-Zertifikaten zum Überprüfen der Identität des Servers während NTLM-basierter Verbindungen</span><span class="sxs-lookup"><span data-stu-id="92946-143">Using SSL certificates to validate server identity during NTLM-based connections</span></span>

<span data-ttu-id="92946-144">Da das NTLM-Authentifizierungsprotokoll nicht die Identität des Zielservers sicherstellen kann (nur, dass er bereits Ihr Kennwort kennt), können Sie Zielserver für die Verwendung von SSL für PowerShell-Remoting konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="92946-144">Since the NTLM authentication protocol cannot ensure the identity of the target server (only that it already knows your password), you can configure target servers to use SSL for PowerShell Remoting.</span></span> <span data-ttu-id="92946-145">Das Zuweisen eines SSL-Zertifikats zum Zielserver (sofern von einer Zertifizierungsstelle ausgestellt, der auch der Client vertraut) ermöglicht NTLM-basierte Authentifizierung, die sowohl die Identität des Benutzers als auch die des Servers garantiert.</span><span class="sxs-lookup"><span data-stu-id="92946-145">Assigning a SSL certificate to the target server (if issued by a Certificate Authority that the client also trusts) enables NTLM-based authentication that guarantees both the user identity and server identity.</span></span>

#### <a name="ignoring-ntlm-based-server-identity-errors"></a><span data-ttu-id="92946-146">Ignorieren von NTLM-basierten Serveridentitätsfehlern</span><span class="sxs-lookup"><span data-stu-id="92946-146">Ignoring NTLM-based server identity errors</span></span>

<span data-ttu-id="92946-147">Wenn es nicht möglich ist, ein SSL-Zertifikat auf einem Server für NTLM-Verbindungen bereitzustellen, können Sie die daraus resultierenden Identitätsfehler unterdrücken, indem Sie den Server zur WinRM-Liste **TrustedHosts** hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="92946-147">If deploying a SSL certificate to a server for NTLM connections is infeasible, you may suppress the resulting identity errors by adding the server to the WinRM **TrustedHosts** list.</span></span> <span data-ttu-id="92946-148">Beachten Sie, dass das Hinzufügen eines Servernamens zur Liste „TrustedHosts“ keine Aussage hinsichtlich der Vertrauenswürdigkeit des Hosts selbst beinhaltet, da das NTLM-Authentifizierungsprotokoll nicht garantieren kann, dass Sie tatsächlich eine Verbindung mit dem von Ihnen beabsichtigten Host herstellen.</span><span class="sxs-lookup"><span data-stu-id="92946-148">Please note that adding a server name to the TrustedHosts list should not be considered as any form of statement of the trustworthiness of the hosts themselves - as the NTLM authentication protocol cannot guarantee that you are in fact connecting to the host you are intending to connect to.</span></span>
<span data-ttu-id="92946-149">Stattdessen sollten Sie die „TrustedHosts“-Einstellung als Liste der Hosts betrachten, für die Sie Fehler unterdrücken möchten, die generiert werden, weil die Identität des Servers nicht überprüft werden kann.</span><span class="sxs-lookup"><span data-stu-id="92946-149">Instead, you should consider the TrustedHosts setting to be the list of hosts for which you wish to suppress the error generated by being unable to verify the server's identity.</span></span>


### <a name="ongoing-communication"></a><span data-ttu-id="92946-150">Laufende Kommunikation</span><span class="sxs-lookup"><span data-stu-id="92946-150">Ongoing Communication</span></span>

<span data-ttu-id="92946-151">Nach Abschluss der anfänglichen Authentifizierung verschlüsselt das [PowerShell-Remotingprotokoll](https://msdn.microsoft.com/library/dd357801.aspx) die gesamte laufende Kommunikation mit einem sitzungsbezogenen, symmetrischen AES-256-Schlüssel.</span><span class="sxs-lookup"><span data-stu-id="92946-151">Once initial authentication is complete, the [PowerShell Remoting Protocol](https://msdn.microsoft.com/library/dd357801.aspx) encrypts all ongoing communication with a per-session AES-256 symmetric key.</span></span>


## <a name="making-the-second-hop"></a><span data-ttu-id="92946-152">Durchführen des zweiten Hops</span><span class="sxs-lookup"><span data-stu-id="92946-152">Making the second hop</span></span>

<span data-ttu-id="92946-153">Standardmäßig verwendet PowerShell-Remoting Kerberos (falls verfügbar) oder NTLM für die Authentifizierung.</span><span class="sxs-lookup"><span data-stu-id="92946-153">By default, PowerShell Remoting uses Kerberos (if available) or NTLM for authentication.</span></span> <span data-ttu-id="92946-154">Beide Protokolle führen eine Authentifizierung gegenüber dem Remotecomputer durch, ohne Anmeldeinformationen an diesen zu senden.</span><span class="sxs-lookup"><span data-stu-id="92946-154">Both of these protocols authenticate to the remote machine without sending credentials to it.</span></span>
<span data-ttu-id="92946-155">Dies ist die sicherste Methode der Authentifizierung, doch da der Remotecomputer nicht über die Anmeldeinformationen des Benutzers verfügt, kann er nicht auf andere Computer und Dienste im Auftrag des Benutzers zugreifen.</span><span class="sxs-lookup"><span data-stu-id="92946-155">This is the most secure way to authenticate, but because the remote machine does not have the user's credentials, it cannot access other computers and services on the user's behalf.</span></span>
<span data-ttu-id="92946-156">Dies ist als „zweites Hop-Problem“ bekannt.</span><span class="sxs-lookup"><span data-stu-id="92946-156">This is known as the "second hop problem".</span></span>

<span data-ttu-id="92946-157">Es gibt verschiedene Möglichkeiten, um dieses Problem zu vermeiden:</span><span class="sxs-lookup"><span data-stu-id="92946-157">There are several ways to avoid this problem.</span></span> <span data-ttu-id="92946-158">Eine Beschreibung dieser Methoden mit ihren jeweiligen Vor- und Nachteilen finden Sie unter [Making the second hop in PowerShell Remoting (Das zweite Hop-Problem in PowerShell Remoting)](PS-remoting-second-hop.md).</span><span class="sxs-lookup"><span data-stu-id="92946-158">For descriptions of these methods, and the pros and cons of each, see [Making the second hop in PowerShell Remoting](PS-remoting-second-hop.md).</span></span>